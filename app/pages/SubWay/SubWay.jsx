import React, { Component } from 'react';
import StrokeExm from './StrokeExm';
import './style.scss';

class SubWay extends Component {
  constructor(props) {
    super(props);
    this.state = {
      active: false,
    };
  }

  componentDidMount() {
    const container = document.querySelector('#map');
    const svgBack = document.querySelector('#back');
    const svgFront = svgBack.cloneNode(true); // 拷贝节点
    svgFront.setAttribute('id', 'front');
    container.appendChild(svgFront);

    let paths = document.querySelectorAll('#front path, #front polyline');
    paths = Array.prototype.slice.call(paths);
    let style = ``;
    const CAR_SIZE = 10; // 移动块长度
    paths.forEach((path, i) => {
      path.setAttribute('id', 'path-' + i);
      const length = path.getTotalLength(); // 获取路径总长度
      const speed = length / 100;

      // 创建虚线，偏移（偏移量由x->0实现移动效果）
      style += `
    #path-${i} {
      stroke-dasharray: ${CAR_SIZE}, ${length / 2};
      stroke-dashoffset: ${length};
      animation: dash-${i} ${speed}s linear alternate infinite;  
    }

    @keyframes dash-${i} {
      from {
        stroke-dashoffset: ${length};
      }
      to {
        stroke-dashoffset: 0;
      }
    }`
    });

    const sheet = document.createElement('style');
    sheet.innerHTML = style;
    document.body.appendChild(sheet);
  }

  onClick = () => {
    this.setState({
      active: !this.state.active
    });
  }

  render() {
    return (
      <div className="mapParent">
        <div className="title">Hang Zhou SubWay</div>
        <div id="map">
          <svg id="back" className="three-D" height="100%" width="100%" viewBox="0 0 2000 2600">
            <g stroke="none" stroke-width="1" fill="none">
              <g className="red">
                <path d="M1930,786L1930 786L1930 723L1928 719L1926 716L1923 713L1920 710L1915 708L1910 706L1903 705L1729 705L1674 706L1470 706L1414 705L916 705L907 706L898 707L891 711L885 716L882 721L881 727L881 735L881 754L880 783L880 916L881 922L883 928L886 932L890 935L894 937L900 938L909 939L1014 939L1020 940L1026 943L1031 946L1071 976L1072 977L1111 1008L1153 1041L1195 1073L1230 1100L1245 1112L1252 1117L1255 1122L1257 1126L1258 1131L1258 1140L1258 1252" />
                <path d="M1617,469L1617 469L1617 651L1618 673L1617 678L1616 684L1614 688L1610 693L1607 696L1601 699L1592 702L1581 706L1470 706L1414 705L916 705L907 706L898 707L891 711L885 716L882 721L881 727L881 735L881 754L880 783L880 916L881 922L883 928L886 932L890 935L894 937L900 938L909 939L1014 939L1020 940L1026 943L1031 946L1071 976L1072 977L1111 1008L1153 1041L1195 1073L1230 1100L1245 1112L1252 1117L1255 1122L1257 1126L1258 1131L1258 1140L1258 1252" />
              </g>
              <g className="orange">
                <path d="M476,476L476 476L552 476L558 477L562 480L565 483L565 675L567 680L570 683L576 685L582 686L607 686L757 686L765 687L772 688L778 690L783 693L786 698L789 703L791 708L791 814L792 820L794 825L797 829L807 835L815 836L822 837L880 837L1020 837L1026 838L1030 839L1033 840L1037 843L1044 849L1047 852L1051 853L1054 855L1058 855L1062 856L1065 856L1215 856L1223 857L1229 859L1235 862L1254 877L1289 904L1317 926L1350 951L1351 952L1399 988L1436 1016L1446 1024L1450 1029L1454 1033L1455 1038L1456 1044L1456 1357" />
              </g>
              <g className="green">
                <path d="M1351,709L1351 709L1284 709L1278 710L1272 710L1267 712L1263 714L1260 717L1258 720L1256 724L1255 728L1255 733L1254 747L1254 788L1254 890L1253 895L1249 901L1245 905L1228 917L1228 918L1203 937L1190 947L1152 975L1152 976L1111 1008L1070 1039L1036 1065L1004 1089L1004 1090L974 1113L968 1118L963 1123L960 1127L959 1133L959 1196L958 1224L958 1253" />
              </g>
              <g className="blue">
                <path d="M211,678L211 678L228 678L230 680L255 703L258 705L262 707L266 707L286 707L288 706L290 705L291 703L291 684L290 677L290 651L289 646L289 638L290 636L292 635L294 635L627 635L628 634L629 634L630 633L630 633L631 632L631 582L632 581L633 580L634 580L635 579L637 579L915 579L963 580L982 582L992 584L999 587L1003 593L1005 598L1005 616L1005 649L1006 671L1007 705L1007 730L1006 779L1006 795L1007 837L1006 883L1007 927L1007 933L1007 945L1002 950L998 953L990 958L978 966L968 973L958 981L956 984L954 985L952 988L950 991L951 993L952 995L955 998L963 1006L988 1027L1036 1065L1091 1108L1099 1113L1105 1119L1108 1124L1109 1130L1109 1163L1110 1170L1110 1173L1112 1177L1115 1178L1119 1178L1127 1179L1165 1179L1204 1179L1258 1178L1329 1177L1374 1176L1391 1175L1456 1173L1544 1173L1545 1174L1549 1173L1552 1174L1554 1174L1555 1176L1556 1178L1556 1180L1556 1189L1555 1212L1555 1230L1556 1232L1558 1232L1562 1233L1685 1233" />
              </g>
              <g className="yellow">
                <path d="M266,707L266 707L109 707L75 706L-15 706L-43 707L-60 707L-62 708L-64 709L-65 710L-67 712L-67 713L-68 714L-68 716L-68 725L-69 759L-70 804L-70 844" />
              </g>
            </g>
          </svg>
        </div>
        <div className="btn" onClick={this.onClick}>
          Click
        </div>
        {this.state.active ? <StrokeExm /> : ''}
        {/* <div className="temp">
          <svg width="580" height="400">
            <g className="red">
              <title>background</title>
              <rect fill="#fff" id="canvas_background" height="402" width="582" y="-1" x="-1" />
              <g display="none" overflow="visible" y="0" x="0" height="100%" width="100%" id="canvasGrid">
                <rect fill="url(#gridpattern)" stroke-width="0" y="0" x="0" height="100%" width="100%" />
              </g>
            </g>
            <g className="blue">
              <title>Layer 1</title>
              <path d="m108.5,94.4375c0,0 1.159134,2.171631 0,6c-1.04483,3.450844 -2.691246,8.0718 -4,13c-1.623314,6.112679 -2.115868,8.963837 -3,12c-1.152771,3.958679 -1.36097,9.142227 -3,15c-1.451065,5.185989 -2.080986,9.10701 -3,13c-1.027489,4.352509 -1.359268,8.051651 -2,12c-0.506538,3.121445 -1.486259,6.823746 -2,9c-0.689262,2.919754 -0.486259,6.823746 -1,9c-0.229752,0.973251 -0.486259,2.823746 -1,5c-1.148766,4.866241 0,7 0,11c0,2 0,3 0,5c0,1 0,2 0,4c0,1 0.617317,3.076126 1,4c0.541199,1.306564 1.173096,2.852737 2,4c1.307449,1.813995 2.292892,3.292892 3,4c0.707108,0.707108 2,3 4,5c1,1 3.186005,1.692551 5,3c1.14727,0.826904 2.053505,0.540497 4,1c2.176254,0.513748 4,1 6,1c2,0 7,0 9,0c3,0 5,0 7,0c1,0 2.906326,-2.103409 4,-3c2.78833,-2.285873 5,-4 7,-6c1,-1 3.2565,-3.796997 4,-5c1.662506,-2.689987 3.11586,-5.963837 4,-9c1.152771,-3.958679 1.679642,-7.025818 2,-9c0.506546,-3.121445 1,-4 1,-5c0,-1 0.662506,-3.310013 -1,-6c-1.487,-2.406006 -3.076126,-3.61731 -4,-4c-1.306564,-0.541199 -2,-1 -3,-1c-1,0 -3,0 -5,0c-3,0 -6,1 -7,2c-1,1 -2.824432,0.097885 -4,2c-0.525726,0.850647 -0.61731,1.076126 -1,2c-0.541199,1.306564 -1,3 -1,4c0,2 0,3 0,4c0,2 0,3 0,5c0,1 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3c0,1 -0.382683,3.076126 0,4c0.541199,1.306564 1.61731,1.076126 2,2c0.541199,1.306564 1.292892,1.292892 2,2c0.707108,0.707108 1,1 2,1c1,0 2,0 3,0c1,0 2,-1 3,-1c1,0 2.076126,0.38269 3,0c1.306564,-0.541199 1.097885,-1.824432 3,-3c0.850647,-0.525726 2.823746,-0.486252 5,-1c0.973251,-0.229752 2.823746,-1.486252 5,-2c1.946503,-0.459503 3.907791,-1.496231 8,-2c2.977524,-0.366547 4.693436,-1.458801 6,-2c1.847763,-0.765366 3.152237,-0.234634 5,-1c1.306564,-0.541199 4.152237,-1.234634 6,-2c1.306564,-0.541199 2.026749,-0.770248 3,-1c2.176254,-0.513748 3.076126,-1.61731 4,-2c1.306564,-0.541199 1.70546,-1.346191 4,-3c1.813995,-1.307449 3,-2 4,-3c1,-1 2.917603,-1.386871 4,-4c0.38269,-0.923874 1.486252,-2.823746 2,-5c0.229752,-0.973251 0,-2 0,-4c0,-2 0.707108,-3.292892 0,-4c-0.707108,-0.707108 -1,-1 -2,-1c-1,0 -2,0 -4,0c-2,0 -4,0 -6,0c-1,0 -3,0 -5,0c-2,0 -4,0 -5,0c-1,0 -2.458801,-0.306564 -3,1c-0.765366,1.847763 -1.486252,3.823746 -2,6c-0.229752,0.973251 0,2 0,4c0,1 0,2 0,3c0,2 0,4 0,5c0,1 0,2 0,3c0,1 -0.38269,2.076126 0,3c0.541199,1.306564 1.693436,1.458801 3,2c0.923874,0.38269 2,0 3,0c1,0 2,0 3,0c3,0 5.076126,0.38269 6,0c1.306564,-0.541199 3.186005,-1.692551 5,-3c1.147263,-0.826904 0.693436,-2.458801 2,-3c0.923874,-0.38269 1,-2 1,-3c0,-2 0,-4 0,-6c0,-1 0,-2 0,-4c0,-2 0,-3 0,-2c0,2 0,7 0,11c0,2 0.486252,2.823746 1,5c0.229752,0.973251 0.61731,1.076126 1,2c0.541199,1.306564 1.076126,1.61731 2,2c1.306564,0.541199 0.823746,2.486252 3,3c0.973251,0.229752 2,0 3,0c2,0 3.693436,-0.458801 5,-1c0.923874,-0.38269 1.076126,-0.61731 2,-1c1.306564,-0.541199 1.977554,-1.139648 14,-3c6.9879,-1.081314 11.162643,-1.289673 17,-3c7.308517,-2.141373 8.881516,-5.190277 12,-7c3.867981,-2.24469 6,-4 7,-6c1,-2 2,-3 2,-5c0,-2 0,-5 0,-6c0,-2 0.307465,-3.186005 -1,-5c-0.826904,-1.147263 -2.458801,-1.693436 -3,-3c-0.38269,-0.923874 -1.309998,-0.337494 -4,-2c-2.406006,-1.487 -5.881516,-5.190277 -9,-7c-1.93399,-1.122345 -2,-2 -3,-2c-2,0 -5.228851,2.729614 -10,7c-3.161316,2.829514 -6.95517,6.549149 -8,10c-0.869354,2.871277 -1.496231,7.907791 -2,12c-0.366547,2.977524 0,7 0,10c0,2 -0.38269,4.076126 0,5c0.541199,1.306564 1.61731,2.076126 2,3c0.541199,1.306564 2.076126,1.61731 3,2c1.306564,0.541199 3.038742,1.480545 6,1c6.242889,-1.013077 9.549149,-2.95517 13,-4c1.914185,-0.579575 5,-2 7,-4c3,-3 6.865479,-5.263657 11,-11c2.614899,-3.627991 3.360962,-8.142227 5,-14c1.45105,-5.185989 2.507324,-9.024338 3,-14c0.502441,-5.074203 2.217712,-9.961349 3,-15c1.389252,-8.948181 1.837036,-14.022064 3,-22c0.877411,-6.01915 1,-9 1,-12c0,-3 0.197083,-3.990265 0,-2c-0.502441,5.074203 -2.098816,13.988266 -3,22c-1.123352,9.986893 -2,20 -2,26c0,6 0,10 0,13c0,4 0,8 0,11c0,2 0,4 0,6c0,2 0,5 0,6c0,2 0,4 0,5c0,1 1,1 2,3l1,1l1,0" id="svg_1" stroke-width="1.5" stroke="#fff" fill="none" />
            </g>
          </svg>
        </div> */}
      </div>
    )
  }
}

export default SubWay;